{% extends "base.html" %}

{# Top app bar: your Figma shows no title here, so we keep it empty #}
{% block appbar %}{% endblock %}

{% block content %}
<style>
  /* ---------- page layout ---------- */
  .home-wrap{ padding: 0 16px 24px; }

  /* ---------- top chips row (Favourites / History / Following / trailing icon) ---------- */
  .chips-row{
    display:flex; gap:8px; padding:0 4px 12px; align-items:center; overflow:auto hidden;
  }
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px; background:#fff; box-shadow:var(--shadow);
    text-decoration:none; color:inherit; white-space:nowrap;
  }
  .chip .icon{ width:16px; height:16px; display:block; color:#6B7280; }

  .chip.trailing{
    margin-left:auto; padding:8px; width:36px; height:36px; justify-content:center;
  }

  /* ---------- search ---------- */
  .search-wrap{ padding:0 0 12px; }
  .search{
    display:flex; align-items:center; gap:10px;
    background:#fff; border-radius:12px; padding:10px 12px; box-shadow:var(--shadow);
  }
  .search .icon{ width:18px; height:18px; display:block; color:#9CA3AF; flex:0 0 18px; }
  .search input{
    border:0; outline:0; width:100%; font-size:14px; background:transparent;
  }

  /* ---------- section headers ---------- */
  .section{ margin:12px 0 8px; display:flex; align-items:center; justify-content:space-between; }
  .section .title{
    font-size:14px;
    font-weight:400;
    color:var(--text);
  }
  .section .seeall{ font-size:12px; color:#6B7280; text-decoration:none; }

  /* ---------- featured banner ---------- */
  .featured{
    width:100%; border-radius:12px; overflow:hidden; box-shadow:var(--shadow); background:#fff;
  }
  .featured img{ width:100%; height:160px; object-fit:cover; display:block; }

  /* ---------- genre chips (round) ---------- */
  .genres{
    display:flex; gap:14px; overflow:auto hidden; padding:6px 2px 4px;
  }
  .gchip{
    text-decoration:none; color:inherit; display:flex; flex-direction:column; align-items:center; gap:6px;
  }
  .gchip .circle{
    width:68px; height:68px; border-radius:50%; background:#fff; box-shadow:var(--shadow); display:flex; align-items:center; justify-content:center;
  }
  .gchip span{ font-size:12px; color:#374151; }

  /* ---------- top rated grid ---------- */
  .grid{
    display:grid; grid-template-columns:repeat(2, 1fr); gap:16px;
    padding-top:6px;
  }
  .card{
    text-decoration:none; color:inherit; background:#fff; border-radius:12px; overflow:hidden; box-shadow:var(--shadow); display:block;
  }
  .card img{ width:100%; height:180px; object-fit:cover; display:block; }
  .meta{ padding:8px; }
  .meta .rating{ font-size:12px; color:#6B7280; margin-bottom:4px; }
  .meta .title{
    font-size:14px;
    font-weight:400;
    line-height:1.25;
    margin:0 0 2px;
    overflow:hidden;
    display:-webkit-box;
    -webkit-box-orient:vertical;
    -webkit-line-clamp:2; /* chromium/safari */
    line-clamp:2;         /* standard (linter hint) */
  }
  .meta .author{ font-size:12px; color:#6B7280; }
</style>

<div class="home-wrap">

<!-- top chips row -->
<div class="chips-row">
  <a class="chip" href="{{ url_for('favourites') }}">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 21l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8z"/>
    </svg>
    Favourites
  </a>
  <a class="chip" href="{{ url_for('history') }}">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="1 4 1 10 7 10"></polyline>
      <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
      <polyline points="12 7 12 12 15 15"></polyline>
    </svg>
    History
  </a>
  <a class="chip" href="{{ url_for('following') }}">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
    Following
  </a>
  <a class="chip" href="{{ url_for('followers') }}">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
    Followers
  </a>
</div>

  <!-- search -->
  <div class="search-wrap">
    <form class="search" action="{{ url_for('browse') }}" method="get">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="7"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input id="q" name="q" type="text" placeholder="Search">
    </form>
  </div>

  <!-- featured -->
  <a class="featured" href="{{ url_for('book_details', title=featured.title) }}">
  <img
    src="{{ featured.cover }}"
    alt="{{ featured.title }}"
    onerror="this.onerror=null;this.src='https://placehold.co/400x600/EEE/AAA?text=No+Cover';"
  >
</a>


  <!-- search by genre -->
  <div class="section" style="margin-top:14px;">
    <div class="title">Search by Genre</div>
    <a class="seeall" href="{{ url_for('browse') }}">See all</a>
  </div>
  <div class="genres">
    {% for g in genres %}
      <a class="gchip" href="{{ url_for('genre_page', name=g) }}">
        <div class="circle">{{ g[0] }}</div>
        <span>{{ g }}</span>
      </a>
    {% endfor %}
  </div>

  <!-- top rated -->
  <div class="section" style="margin-top:18px;">
    <div class="title">Top Rated Books</div>
    <a class="seeall" href="{{ url_for('top_rated') }}">See all</a>
  </div>
  <div class="grid">
    {% for b in top_rated %}
      <a class="card" href="{{ url_for('book_details', title=b.title) }}">
        <img
  src="{{ b.cover }}"
  alt="{{ b.title }}"
  onerror="this.onerror=null;this.src='{{ PLACEHOLDER_COVER }}';">

        <div class="meta">
          <div class="rating">{{ '%.2f'|format(b.rating) }} avg rating</div>
          <div class="title">{{ b.title }}</div>
          <div class="author">{{ b.author }}</div>
        </div>
      </a>
    {% endfor %}
  </div>

</div>
{% endblock %}
