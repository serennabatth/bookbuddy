{% extends "base.html" %}

{% block appbar %}
<style>
  .appbar, header.appbar, .topbar, .header {
    background:#fff !important;
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }

  
  .appbar-inner, .appbar .inner, .appbar, header.appbar {
    display:grid;
    grid-template-columns: 44px 1fr 44px;
    align-items:center;
  }

  .navicon{
    background:transparent !important;
    border:none !important;
    box-shadow:none !important;
    padding:0 !important;
    width:44px;
    height:44px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:0 !important;
    color:#111;
  }

  .h1{
    text-align:center;
    font-weight:700;
    color:#111;
  }
</style>

  <a class="navicon" href="{{ url_for('home') }}" aria-label="Back">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </a>

  <div class="h1">History</div>

  <!-- spacer to keep the title perfectly centred -->
  <div aria-hidden="true"></div>
{% endblock %}

{% block content %}
<style>
  
  .wrap{
    padding: 14px 16px 28px;
    max-width: 520px;
    margin: 0 auto;
  }

  .h-search{
    display:flex;
    align-items:center;
    gap:10px;
    height:44px;
    padding:0 14px;
    border-radius:14px;
    background:#fff;
    border: 1px solid rgba(0,0,0,0.06);
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  }
  .h-search .icon{
    width:18px; height:18px;
    color: rgba(0,0,0,0.45);
    flex:0 0 18px;
  }
  .h-search input{
    width:100%;
    border:0 !important;
    outline:0 !important;
    background:transparent !important;
    box-shadow:none !important;
    -webkit-appearance:none;
    appearance:none;
    font-size:15px;
    color:#111;
    padding:0 !important;           
    margin:0 !important;
  }
  .h-search input::placeholder{ color: rgba(0,0,0,0.45); }

  
  .h-grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px 16px;
    margin-top: 14px;
  }

  .h-tile{
    display:block;
    text-decoration:none;
    color:inherit;
    background:transparent !important;
    border:none !important;
    box-shadow:none !important;
    padding:0 !important;
  }

  .h-cover{
    width:100%;
    height: 170px;
    object-fit: cover;
    display:block;
    border-radius: 16px;
    background: rgba(0,0,0,0.06);
  }

  
.h-meta{
  margin-top:6px;   
}

.h-rating{
  font-size:12px;
  color: rgba(0,0,0,0.45);
  margin-bottom:2px;   
  line-height:1.2;
}

.h-title{
  font-size:16px;
  font-weight:550;
  line-height:1.32;     
  letter-spacing:-0.01em;
  margin-bottom:2px;    

  overflow:hidden;
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:2;
  line-clamp:2;
  padding-bottom:2px;   
}

.h-author{
  font-size:13px;
  color: rgba(0,0,0,0.45);
  line-height:1.2;
  margin-top:0;        
}


  /* Empty state */
  .empty{
    margin-top: 16px;
    text-align:center;
    color: rgba(0,0,0,0.55);
    padding: 18px 10px;
  }
  .empty .t{
    color:#111;
    font-weight:750;
    margin-bottom:6px;
    font-size:16px;
  }
</style>

<div class="wrap">

  <form class="h-search" action="{{ url_for('history') }}" method="get">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="7"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    <input
      type="text"
      name="q"
      value="{{ (request.args.get('q') or '')|e }}"
      placeholder="Search"
      autocomplete="off"
    >
  </form>

  {% set q = (request.args.get('q') or '') | lower %}

  {% set filtered = [] %}
  {% for b in books %}
    {% if (not q) or (q in (b.title|lower)) or (q in (b.author|lower)) %}
      {% set _ = filtered.append(b) %}
    {% endif %}
  {% endfor %}

  {% if filtered and filtered|length %}
    <div class="h-grid">
      {% for b in filtered %}
        <a class="h-tile" href="{{ url_for('book_details', title=b.title) }}">
          <img
            class="h-cover"
            src="{{ b.cover }}"
            alt="{{ b.title }}"
            onerror="this.onerror=null;this.src='https://placehold.co/400x600/EEE/AAA?text=No+Cover';"
          >
          <div class="h-meta">
            <div class="h-rating">{{ '%.2f'|format(b.rating) }} avg rating</div>
            <div class="h-title">{{ b.title }}</div>
            <div class="h-author">{{ b.author }}</div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty">
      <div class="t">No history yet</div>
      <div>This page will show books youâ€™ve opened recently.</div>
      <div style="margin-top:12px;">
        <a class="button" href="{{ url_for('browse') }}" style="height:40px;">Browse books</a>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
