{% extends "base.html" %}

{% block appbar %}
  <a class="navicon" href="{{ url_for('profile_page') }}" aria-label="Back">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </a>

  <div class="h1" style="width:100%; text-align:center; margin-right:36px;">
    Followers
  </div>
{% endblock %}

{% block content %}
<style>
  /* ---- Header bar: match Edit Profile (white strip) ---- */
  header, .appbar, .topbar {
    background:#fff !important;
  }
  header{
    border-bottom:1px solid rgba(0,0,0,.08);
  }

  /* Back arrow – remove any square styling */
  .navicon{
    background:none !important;
    border:none !important;
    box-shadow:none !important;
    padding:8px;
    border-radius:0 !important;
    text-decoration:none;
    color:inherit;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .navicon:focus,
  .navicon:active{
    outline:none;
    box-shadow:none !important;
  }

  .wrap{
    max-width:420px;
    margin:0 auto;
    padding:12px 16px 24px;
  }

  /* ---- Search bar (NO inner rectangle) ---- */
  .search{
    display:flex;
    align-items:center;
    gap:10px;
    background:#fff;
    border-radius:14px;
    padding:12px 14px;
    box-shadow:var(--shadow);
    border:1px solid rgba(0,0,0,.06);
  }
  .search .icon{
    width:18px;
    height:18px;
    color:#9CA3AF;
    flex:0 0 18px;
  }
  .search input{
    width:100%;
    border:0 !important;
    outline:0 !important;
    background:transparent !important;
    box-shadow:none !important;
    padding:0 !important;
    margin:0 !important;
    font-size:16px;
    font-family:inherit;
    color:var(--text);
    -webkit-appearance:none;
    appearance:none;
  }
  .search input::placeholder{ color:#9CA3AF; }

  /* ---- LIST: force NO white panel behind it ---- */
  .list{
    margin-top:14px;
    background:transparent !important;
    box-shadow:none !important;
    border:0 !important;
    border-radius:0 !important;
    overflow:visible !important;
  }

  /* Rows sit on page background with thin divider under each */
  .row{
    display:flex;
    align-items:center;
    gap:14px;
    padding:18px 0;
    background:transparent !important;  /* kills any leftover white */
    box-shadow:none !important;
    border-bottom:1px solid rgba(0,0,0,.12);
  }
  .row:last-child{ border-bottom:0; }

  .avatar{
    width:56px;
    height:56px;
    border-radius:50%;
    background:#D1D5DB;
    flex:0 0 56px;
  }

  .meta{
    flex:1 1 auto;
    min-width:0;
  }
  .name{
    font-size:18px;
    font-weight:500;
    color:var(--text);
    line-height:1.1;
  }
  .handle{
    font-size:14px;
    color:var(--text-2);
    margin-top:6px;
  }

  /* Remove button: same font system as rest of page */
  .pill{
    height:36px;
    min-width:132px;
    padding:0 16px;
    border-radius:10px;
    border:0;
    background:#fff;
    box-shadow:none; /* Figma looks flat; tell me if you want shadow */
    color:var(--text);
    font-family:inherit;      /* ✅ same font */
    font-size:16px;           /* ✅ same sizing vibe */
    font-weight:500;          /* ✅ not heavier than body */
    cursor:pointer;
  }
  .pill:active{ filter:brightness(.97); }
  .pill:disabled{ opacity:.6; cursor:not-allowed; }
</style>

<div class="wrap">
  <form class="search" action="{{ url_for('followers') }}" method="get">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="7"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    <input type="text" name="q" value="{{ (request.args.get('q') or '')|e }}" placeholder="Search">
  </form>

  <div class="list" id="list">
    {% for p in people %}
      <div class="row" data-handle="{{ p.handle }}">
        <div class="avatar" aria-hidden="true"></div>

        <div class="meta">
          <div class="name">{{ p.name }}</div>
          <div class="handle">{{ p.handle }}</div>
        </div>

        <button type="button" class="pill js-remove" data-handle="{{ p.handle }}">Remove</button>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  document.querySelectorAll('.js-remove').forEach(btn => {
    btn.addEventListener('click', async () => {
      const handle = btn.dataset.handle;
      btn.disabled = true;

      try {
        const res = await fetch('{{ url_for("api_followers_remove") }}', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({handle})
        });
        const json = await res.json();
        if (!json.ok) throw new Error(json.error || 'Failed');

        btn.closest('.row')?.remove();
      } catch (e) {
        alert('Could not remove follower. Please try again.');
        btn.disabled = false;
      }
    });
  });
</script>
{% endblock %}
